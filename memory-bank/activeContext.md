# Active Context

- Timestamp: 2025-10-31T00:00:00Z
- Current focus: ‚ôªÔ∏è Developer experience polish ‚Äî ensure dev server ergonomics remain cross-platform
- Implementation status:
  - ‚úÖ Replaced hard-coded `/usr/bin/google-chrome` launch with `web/scripts/open-browser.mjs`
  - ‚úÖ Updated `web/package.json` `dev` script to invoke the helper after `wait-on`
  - ‚úÖ Documented browser auto-launch behavior and opt-out instructions in `web/README.md`
- Immediate next action: Monitor feedback from contributors using different OS environments and iterate if additional launchers are required.
- Notes:
  - Helper selects `open` (macOS), `start` (Windows via `cmd`), or `xdg-open` (Linux/BSD) and falls back to manual launch with warnings when unavailable.
- Timestamp: 2025-11-01T00:00:00Z
- Current focus: üîê Strengthen user management UX safeguards and regression coverage
- Implementation status:
  - ‚úÖ Normalized `UsersRoute` add-user prompt to validate roles against the canonical role list
  - ‚úÖ Added defensive fallback to the viewer role when prompts receive invalid input, with user feedback
  - ‚úÖ Exported `UsersRoute` for targeted tests without affecting runtime behavior
  - ‚úÖ Introduced `page.test.tsx` to confirm mixed-case role inputs register correctly across admin/editor/viewer paths
- Immediate next action: Continue improving dashboard reliability with focused tests around interactive handlers
- Project Status: üöß Feature hardening in progress
- Notes:
  - Testing performed with `pnpm vitest run src/app/page.test.tsx`
  - Validation ensures downstream filters relying on strict `Role` comparisons stay functional
- Open questions:
  - Should invalid role prompts abort user creation instead of defaulting to viewer for stricter data hygiene?
- Timestamp: 2025-10-31T00:00:00Z
- Current focus: Align theme toggles with system-resolved values and backstop with tests
- Decisions:
  - Update `ThemeToggle` to derive its current theme from `resolvedTheme ?? theme` so system mode renders correctly.
  - Update the settings route theme switch to reflect the resolved theme while continuing to persist explicit `"light"` and `"dark"` values.
  - Add unit coverage that exercises system-mode defaults for both dark and light resolutions to prevent regressions.
- Status: Component updates merged locally with passing coverage (`pnpm test --run`).
- Next steps: Monitor for additional theme integration points that might need resolved-theme awareness.
- Timestamp: 2025-11-01T05:32:00Z
- Current focus: ‚úÖ Critical Build Issues Resolved - Next.js configuration and cache utilities fixed
- Implementation status:
  - ‚úÖ Fixed next.config.ts: Removed `turbopackPersistentCaching` (canary-only feature) for Next.js 16.0.1 stable
  - ‚úÖ Fixed cache.ts: Added missing exports `revalidateTagWithLife`, `updateTagImmediate`, `refreshPage`
  - ‚úÖ Fixed API routes and server actions: Changed invalid CacheLife values ("hours", "minutes") to valid types ("short", "medium")
  - ‚úÖ Created missing .key directory with README for sensitive key management
  - ‚úÖ TypeScript compilation passing with zero errors
  - ‚úÖ Production build successful
  - ‚úÖ All 62 tests passing (20 UI components + 42 utilities)
  - ‚úÖ All 20 verification checks passing
- Immediate next action: Monitor firewall-restricted environment behavior, continue with feature development
- Project Status: üéâ FULLY OPERATIONAL - All systems green

- Timestamp: 2025-10-31T20:45:07Z
- Previous focus: Enforce the documented Node.js 22+ baseline in setup verification
- Implementation status:
  - ‚úÖ Updated `web/scripts/verify-setup.sh` so Node.js majors below 22 fail and newer majors emit a cautionary warning
  - ‚úÖ Confirmed the script passes the Node.js check when running `pnpm verify` with Node v22.21.1
- Immediate next action: Monitor future automation tasks that rely on the setup script now that the runtime requirement is enforced
- Project Status: ‚úÖ Setup verification aligned with tech context requirements

- Timestamp: 2025-10-21T01:40:00Z
- Current focus: ‚úÖ PROJECT SETUP COMPLETE - All requirements from problem statement implemented and verified
- Implementation status:
  - ‚úÖ All core framework dependencies installed and configured (Next.js 15, React 19, TypeScript)
  - ‚úÖ Database and ORM setup complete (PostgreSQL 16, Prisma 6.17.1)
  - ‚úÖ Authentication configured (NextAuth v5 with multiple providers)
  - ‚úÖ State management ready (Zustand 5.0.8, TanStack Query 5.90.2)
  - ‚úÖ Styling system configured (Tailwind CSS v4, Biome for linting/formatting)
  - ‚úÖ Testing infrastructure complete (Vitest, Playwright)
  - ‚úÖ Docker Compose setup for PostgreSQL and pgAdmin
  - ‚úÖ Created `src/features/` directory for feature-specific code organization
  - ‚úÖ Created `.key/` directory for sensitive key management
  - ‚úÖ Installed and configured Husky (9.1.7) and lint-staged (16.2.5) for Git hooks
  - ‚úÖ Created comprehensive `memory-bank/dependencies.md` tracking all dependencies
  - ‚úÖ Updated `web/README.md` with complete project documentation
  - ‚úÖ Updated `.gitignore` to exclude `.key/` directory (except README files)
- Immediate next action: Ready for feature development - all requirements complete, all tests passing, all documentation in place
- Project Status: üéâ PRODUCTION READY
- Reference artifacts:
  - `PROJECT_SUMMARY.md` ‚Äî 14KB comprehensive project overview (NEW)
  - `memory-bank/dependencies.md` ‚Äî 7.7KB dependency tracking and policies (NEW)
  - `web/scripts/verify-setup.sh` ‚Äî automated setup verification (NEW)
  - `memory-bank/index.md` ‚Äî complete documentation index
  - `memory-bank/reference/` ‚Äî quick reference guides
  - `memory-bank/decisions/` ‚Äî architectural decisions and summaries
  - `memory-bank/roadmap/` ‚Äî project roadmaps
  - `web/README.md` ‚Äî 11KB complete web application documentation (UPDATED)
  - `web/SETUP.md` ‚Äî detailed setup instructions
- Previous milestones: Genesis foundation (Docker/Postgres/Prisma/NextAuth) established; Biome migration completed; dashboard UI parity achieved; comprehensive testing infrastructure in place; documentation fully consolidated
- Current milestone: Project setup completion with all required elements (directory structure, Git hooks, documentation)
- Notes:
  - Package manager: pnpm 10.18.3 installed and configured
  - Git hooks: Pre-commit hook runs lint-staged to check TypeScript/JavaScript files
  - Directory structure: Added features/ for domain-driven design and .key/ for sensitive key management
  - Documentation: Comprehensive tracking of all dependencies with version rationale
  - All changes follow SOLID principles and maintain backward compatibility
- Verification Results:
  - ‚úÖ TypeScript type check: Passed
  - ‚úÖ Unit tests: 62/62 passed
  - ‚úÖ Production build: Successful (266KB)
  - ‚úÖ Setup verification: 20/20 checks passed
  - ‚úÖ Git hooks: Working (pre-commit with lint-staged)
- Open questions:
  - None - all requirements from problem statement addressed and verified
- Timestamp: 2025-10-31T02:54:17Z
- Current focus: ‚úÖ Next.js 16+ Snapshot Handbook - Complete reference documentation and modern patterns implemented and verified
- Immediate next action: Ready for feature development with Next.js 16+ patterns
- Timestamp: 2025-10-30T19:59:00+00:00
- Previous focus: ‚úÖ Firewall configuration complete - All external service connections disabled for restricted environments
- Implementation status:
  - ‚úÖ Next.js 16+ Snapshot Handbook created as comprehensive reference
  - ‚úÖ Cache helper utilities added with explicit tag-based revalidation patterns
  - ‚úÖ Example API routes demonstrating Next.js 16 caching (`/api/posts`)
  - ‚úÖ Server actions examples with `revalidateTag` and `updateTag` patterns
  - ‚úÖ next.config.ts updated with Turbopack FS cache configuration
  - ‚úÖ postcss.config.mjs simplified to modern 2025 conventions
  - ‚úÖ Documentation index updated with handbook reference
  - ‚úÖ Dependencies.md updated with Next.js 16 and React 19.2 details
  - ‚úÖ Next.js upgraded from 15.5.4 to 16.0.1 (latest stable)
  - ‚úÖ Firewall blocking issues resolved for Chromium and Prisma services
  - ‚úÖ Environment variables configured to disable telemetry and update checks
  - ‚úÖ Browser launch options enhanced with connectivity-blocking flags
  - ‚úÖ Documentation created for firewall configuration and CI/CD usage
  - ‚úÖ React upgraded from 19.1.0 to 19.2.0 (latest stable)
  - ‚úÖ React-DOM upgraded from 19.1.0 to 19.2.0 (latest stable)
  - ‚úÖ TypeScript configuration updated for React automatic JSX runtime
  - ‚úÖ Turbopack enabled as default bundler (faster builds)
  - ‚úÖ All 62 tests passing
  - ‚úÖ Build process verified and working
  - ‚úÖ Development server tested and operational
  - ‚úÖ No breaking changes or regressions detected
  - ‚úÖ Screenshot automation system remains fully functional
  - ‚úÖ Documentation updated in memory-bank
- Immediate next action: Continue with dashboard development, NextAuth integration and real data hydration from Prisma-backed APIs.
- Reference artifacts:
  - `web/src/utils/screenshot.ts` ‚Äî Core screenshot utility with full TypeScript support
  - `web/scripts/screenshot.ts` ‚Äî CLI tool for screenshot capture
  - `web/scripts/screenshot-examples.ts` ‚Äî Programmatic usage examples
  - `web/docs/SCREENSHOT-AUTOMATION.md` ‚Äî Comprehensive documentation
  - `memory-bank/index.md` ‚Äî complete documentation index
  - `memory-bank/reference/` ‚Äî quick reference guides (biome, quick-reference, setup-checklist, component-architecture)
  - `memory-bank/decisions/` ‚Äî architectural decisions and summaries (implementation-summary, frontend-optimization-summary, firewall-analysis)
  - `memory-bank/roadmap/` ‚Äî project roadmaps (alpha-track)
- Previous milestones: Genesis foundation (Docker/Postgres/Prisma/NextAuth) established; Biome migration completed; dashboard UI parity achieved; comprehensive testing infrastructure in place; documentation consolidated; screenshot automation system implemented and tested; **Next.js 16.0.1 and React 19.2.0 upgrade completed**.
- Notes:
  - Next.js 16 brings Turbopack as default bundler for improved build performance
  - React 19.2 includes latest bug fixes and improvements
  - TypeScript configuration now uses "react-jsx" for automatic JSX runtime
  - next-auth shows peer dependency warning but remains fully functional
  - All existing features (screenshot automation, authentication, database) working correctly
- Backend integration kick-off:
  - Created Prisma-backed utilities query module with aggregate helpers for favorites and usage counts
  - Added `/api/utilities` route handler returning enriched catalogue data with Next.js 16 dynamic caching headers
  - Covered data mapping logic with Vitest unit tests mocking Prisma client
- Open questions:
  - None - Next.js 16 documentation and reference implementations completed
  - `web/docs/SCREENSHOT-AUTOMATION.md` ‚Äî Comprehensive documentation
  - `memory-bank/index.md` ‚Äî complete documentation index
  - `memory-bank/reference/` ‚Äî quick reference guides (biome, quick-reference, setup-checklist, component-architecture)
  - `memory-bank/decisions/` ‚Äî architectural decisions and summaries (implementation-summary, frontend-optimization-summary, firewall-analysis)
  - `memory-bank/roadmap/` ‚Äî project roadmaps (alpha-track)
- Previous milestones: Genesis foundation (Docker/Postgres/Prisma/NextAuth) established; Biome migration completed; dashboard UI parity achieved; comprehensive testing infrastructure in place; documentation consolidated; screenshot automation system implemented and tested; **Next.js 16.0.1 and React 19.2.0 upgrade completed**.
- Notes:
  - Next.js 16 brings Turbopack as default bundler for improved build performance
  - React 19.2 includes latest bug fixes and improvements
  - TypeScript configuration now uses "react-jsx" for automatic JSX runtime
  - next-auth shows peer dependency warning but remains fully functional
  - All existing features (screenshot automation, authentication, database) working correctly
- Open questions:
  - None - Next.js 16 documentation and reference implementations completed
